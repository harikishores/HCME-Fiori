/*



 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved



 */



jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");jQuery.sap.require("sap.ui.core.mvc.Controller");jQuery.sap.require("sap.m.MessageBox");jQuery.sap.require("sap.ca.ui.model.type.Number");jQuery.sap.require("sap.ca.ui.model.type.Date");jQuery.sap.require("sap.ui.core.delegate.ScrollEnablement");sap.ca.scfld.md.controller.BaseFullscreenController.extend("cus.sd.myquotations.view.ItemDetails",{itemID:"",isNavToMaster:false,isEditable:false,formEditable:function(e){return this.isEditable},formDisplay:function(e){return!this.isEditable},formChangedValidDate:function(e){var p={isDate:true,evt:e,msg:null,emptyCheck:false};cus.sd.myquotations.util.ModelExtractor.validationEmptyField(p)},formChangedInputQuantity:function(e){var m=this.resourceBundle.getText("ENTER_VALID_QUANTITY");cus.sd.myquotations.util.ModelExtractor.validationInputNumber(e,m,true)},formChangedInputDiscount:function(e){var m=this.resourceBundle.getText("ENTER_VALID_DISCOUNT");cus.sd.myquotations.util.ModelExtractor.validationInputNumber(e,m,false)},onInit:function(){sap.ca.scfld.md.controller.BaseFullscreenController.prototype.onInit.call(this);var t=this;this.resourceBundle=this.oApplicationFacade.getResourceBundle();this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="ItemDetails"){this.isEditable=true}else{this.isEditable=false}var m=t.oApplicationFacade.getApplicationModel("NewQuotation");if(e.getParameter("name")==="ItemDetails"||e.getParameter("name")==="ItemDisplay"){if(m&&!jQuery.isEmptyObject(m.oData)){this._clearControlsErrorState();var r=t.oApplicationFacade.getApplicationModel("rejectionReason");this.getView().setModel(r,"rejectionReason");this.getView().setModel(m,"myQuotationModel");this.itemID=e.getParameter("arguments").itemID;var a=this.getView().getModel("myQuotationModel").getProperty("/QuotationItemSet/results");var b=new sap.ui.model.json.JSONModel();this.getView().setModel(b,"myItem");for(var i=0;i<a.length;i++){if(this.itemID===a[i].ItemID){b.setData(jQuery.extend(true,{},a[i]))}}}else{this.isNavToMaster=true}}},this);sap.ui.core.delegate.ScrollEnablement._bScrollToInput=true},onAfterRendering:function(e){if(this.isNavToMaster){this.isNavToMaster=false;this.oRouter.navTo("master",undefined,true)}},_checkFormErrors:function(){var f=false;var q=this.getView().byId("ORDERIDQTY");if(q.getProperty("valueState")==="Error"){f=true}var r=this.getView().byId("REDELDATEITEM");if(r.getProperty("valueState")==="Error"){f=true}var d=this.getView().byId("DISCOUNTITEMD");if(d.getProperty("valueState")==="Error"){f=true}if(f){sap.m.MessageBox.show(this.resourceBundle.getText("CHECKERRORS"),sap.m.MessageBox.Icon.WARNING,this.resourceBundle.getText("MANDATORYTITLE"),[sap.m.MessageBox.Action.OK]);return f}},_clearControlsErrorState:function(){this.getView().byId("ORDERIDQTY").setValueState(sap.ui.core.ValueState.None);this.getView().byId("REDELDATEITEM").setValueState(sap.ui.core.ValueState.None);this.getView().byId("DISCOUNTITEMD").setValueState(sap.ui.core.ValueState.None)},dialogWithNavigation:function(m,q,t){var a=this;sap.m.MessageBox.show(this.resourceBundle.getText(m,q),sap.m.MessageBox.Icon.SUCCESS,this.resourceBundle.getText(t),[sap.m.MessageBox.Action.OK],function(A){if(A===sap.m.MessageBox.Action.OK){if(jQuery.device.is.phone){a.oRouter.navTo("master")}else{a.oRouter.navTo("detail",{contextPath:q},false)}}})},onDone:function(){if(this._checkFormErrors()){return}var r=this.oApplicationFacade.getApplicationModel("NewQuotation").getProperty("/QuotationItemSet/results");var m=this.getView().getModel("myItem");for(var i=0;i<r.length;i++){if(this.itemID===r[i].ItemID){r[i]=jQuery.extend(true,{},m.getData())}}window.history.back()},onCancel:function(){var t=this;if(this.isEditable){sap.m.MessageBox.show(this.resourceBundle.getText("LOOSEALLCHANGES"),sap.m.MessageBox.Icon.WARNING,this.resourceBundle.getText("WARNING"),[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(a){if(a===sap.m.MessageBox.Action.OK){t._clearControlsErrorState();t.navCancel()}})}else{t.navCancel()}},navCancel:function(){window.history.back()},});



